# Threat Model (LifeMerge)

## Акторы
- **Злоумышленник без учётки:** пытается получить доступ к API, подделать трафик, подменить приложение.
- **Скомпрометированный пользователь:** пытается украсть/подменить данные других пользователей.
- **Внутренний нарушитель:** доступ к логам/базе, попытка извлечь PII и финданные.

## Основные угрозы и меры
1. **Кража токенов доступа**
   - HTTPS везде, `secure`/`HttpOnly` для refresh-cookie в web, для mobile храним в OS Keychain/Keystore.
   - Ротация refresh каждые 30 дней, отзыв токенов при logout/all-devices.
2. **Инъекции и эскалация прав**
   - Parametrized queries/ORM; входные данные валидируются схемами, лимиты длины.
   - RBAC: проверки на уровне handler и сервисов, аудит действий admin/support.
3. **Подмена/утечка данных при синхронизации**
   - Подпись ответов `ETag`, HSTS, защита от downgrade TLS, pinning сертификата в мобильном приложении.
   - Консистентность через `updated_at` и версии записей.
4. **Утечка PII и финансовых данных из логов/бэкапов**
   - Маскирование карт и сумм в логах, шифрование бэкапов и снапшотов, доступ по VPN/KMS.
5. **DDoS и rate abuse**
   - Rate limit per IP/user, капча на signup, отдельные лимиты для дорогих AI-вызовов.
6. **Loss/Corruption данных клиента**
   - Защита локальной БД паролем ОС, шифрование AES-256; периодический бэкап пользовательских настроек в облако (opt-in).

## Остаточные риски
- Социальная инженерия и фишинг вне приложения.
- Утечки на стороне сторонних интеграций (Google/Apple/банки) — минимизируются мониторингом и отзывом токенов.
