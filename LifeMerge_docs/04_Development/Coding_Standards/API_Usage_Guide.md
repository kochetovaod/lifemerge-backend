# Руководство по использованию API

## Аутентификация
- Получаем `access_token` и `refresh_token` через `/auth/login` (см. Auth_API.md).
- Добавляем `Authorization: Bearer <token>` к каждому запросу.
- При 401 с причиной `token_expired` вызываем `/auth/refresh`, повторяем оригинальный запрос с тем же `request_id`.

## Общие правила запросов
- **Базовый URL:** определяется окружением (`DEV_API_BASE`, `STAGE_API_BASE`, `PROD_API_BASE`).
- **Версионирование:** используем префикс `/v1/` для всех путей.
- **Идемпотентность:** для POST/PATCH/DELETE передаём `X-Idempotency-Key` или поле `request_id` в body.
- **Пагинация:** `?limit=50&cursor=<ts_or_id>`; получаем `next_cursor` в ответе.
- **Локализация/часовой пояс:** заголовок `X-Timezone` (IANA) и `Accept-Language`.

## Ошибки
- Формат: `{ "error": { "code": "validation_error", "message": "...", "details": {...} } }`.
- Статусы: 400 валидация, 401 auth, 403 permissions, 404 not found, 409 конфликт версии, 429 лимиты, 500/503 сервер.
- Все клиенты логируют `request_id` из ответа или заголовка.

## Практики для мобильного клиента
- Отправлять `app_version`, `platform`, `device_id` в заголовках для аналитики и feature flags.
- Кешировать справочники (категории задач/финансов) с TTL и ETag; при 304 используем локальные данные.
- Объединять небольшие изменения в батчи (например, до 20 событий календаря) для снижения сетевых вызовов.
- Использовать `If-Modified-Since`/`If-None-Match` при загрузке календаря и задач.

## Тестовые данные
- В dev/stage заведены тест-аккаунты `demo_userX@example.com` с предзаполненными задачами, целями и транзакциями.
- Для нагрузочных тестов генерируйте синтетические данные через скрипт `tools/seed_demo_data.py` (backend репозиторий).
